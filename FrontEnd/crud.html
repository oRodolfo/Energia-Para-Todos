<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Administrador - Energia para Todos</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --color-bg-dark: #0a0a0a;
      --color-bg-light: #1a1a1a;
      --color-card: #1e1e1e;
      --color-text: #f5f5f5;
      --color-text-muted: #999;
      --accent: #ff9500;
      --accent-light: #ffb84d;
      --accent-dim: rgba(255, 149, 0, 0.1);
      --success: #00ff88;
      --error: #ff4444;
      --warning: #ffbb33;
      --info: #33b5e5;
      --border: rgba(255, 255, 255, 0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--color-bg-dark);
      color: var(--color-text);
      min-height: 100vh;
    }

    /* SIDEBAR */
    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      width: 280px;
      height: 100vh;
      background: var(--color-bg-light);
      border-right: 1px solid var(--border);
      padding: 2rem 0;
      z-index: 1000;
      overflow-y: auto;
    }

    .sidebar-header {
      padding: 0 2rem 2rem;
      border-bottom: 1px solid var(--border);
      margin-bottom: 2rem;
    }

    .sidebar-header h1 {
      font-size: 1.5rem;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .sidebar-header p {
      font-size: 0.85rem;
      color: var(--color-text-muted);
    }

    .sidebar-menu {
      list-style: none;
    }

    .menu-item {
      margin: 0.25rem 1rem;
    }

    .menu-link {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.875rem 1rem;
      color: var(--color-text-muted);
      text-decoration: none;
      border-radius: 12px;
      transition: all 0.2s;
      font-weight: 500;
    }

    .menu-link:hover {
      background: var(--accent-dim);
      color: var(--accent);
    }

    .menu-link.active {
      background: var(--accent-dim);
      color: var(--accent);
      font-weight: 600;
    }

    .menu-link i {
      width: 20px;
      text-align: center;
    }

    .menu-section {
      padding: 1.5rem 2rem 0.5rem;
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--color-text-muted);
    }

    /* MAIN CONTENT */
    .main-content {
      margin-left: 280px;
      padding: 2rem;
      min-height: 100vh;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1.5rem;
      border-bottom: 1px solid var(--border);
    }

    .top-bar h2 {
      font-size: 2rem;
      color: var(--color-text);
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.75rem 1.25rem;
      background: var(--color-card);
      border-radius: 12px;
      border: 1px solid var(--border);
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--accent-dim);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--accent);
      font-weight: 700;
    }

    .btn-logout {
      padding: 0.5rem 1rem;
      background: var(--error);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
    }

    .btn-logout:hover {
      background: #cc0000;
      transform: translateY(-2px);
    }

    /* CARDS DE M√âTRICAS */
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .metric-card {
      background: var(--color-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 1.5rem;
      position: relative;
      overflow: hidden;
      transition: all 0.3s;
    }

    .metric-card:hover {
      border-color: var(--accent);
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(255, 149, 0, 0.15);
    }

    .metric-card::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 100px;
      height: 100px;
      background: var(--accent-dim);
      border-radius: 50%;
      transform: translate(30%, -30%);
    }

    .metric-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1rem;
      position: relative;
      z-index: 1;
    }

    .metric-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }

    .metric-icon.orange { background: var(--accent-dim); color: var(--accent); }
    .metric-icon.green { background: rgba(0, 255, 136, 0.1); color: var(--success); }
    .metric-icon.blue { background: rgba(51, 181, 229, 0.1); color: var(--info); }
    .metric-icon.red { background: rgba(255, 68, 68, 0.1); color: var(--error); }

    .metric-value {
      font-size: 2rem;
      font-weight: 800;
      color: var(--color-text);
      margin-bottom: 0.25rem;
    }

    .metric-label {
      font-size: 0.875rem;
      color: var(--color-text-muted);
      font-weight: 500;
    }

    .metric-change {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.25rem 0.5rem;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-top: 0.5rem;
    }

    .metric-change.positive {
      background: rgba(0, 255, 136, 0.1);
      color: var(--success);
    }

    .metric-change.negative {
      background: rgba(255, 68, 68, 0.1);
      color: var(--error);
    }

    /* SE√á√ïES */
    .section {
      background: var(--color-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border);
    }

    .section-title {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--color-text);
    }

    .section-title i {
      color: var(--accent);
    }

    /* TABELAS */
    .table-container {
      overflow-x: auto;
      border-radius: 12px;
      border: 1px solid var(--border);
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    thead {
      background: rgba(255, 149, 0, 0.05);
    }

    th {
      padding: 1rem;
      text-align: left;
      font-weight: 600;
      color: var(--accent);
      font-size: 0.875rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    td {
      padding: 1rem;
      border-top: 1px solid var(--border);
      color: var(--color-text-muted);
    }

    tbody tr {
      transition: background 0.2s;
    }

    tbody tr:hover {
      background: rgba(255, 149, 0, 0.03);
    }

    /* BADGES */
    .badge {
      display: inline-block;
      padding: 0.375rem 0.75rem;
      border-radius: 8px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .badge-success { background: rgba(0, 255, 136, 0.1); color: var(--success); }
    .badge-warning { background: rgba(255, 187, 51, 0.1); color: var(--warning); }
    .badge-error { background: rgba(255, 68, 68, 0.1); color: var(--error); }
    .badge-info { background: rgba(51, 181, 229, 0.1); color: var(--info); }

    /* BOT√ïES */
    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent), var(--accent-light));
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 149, 0, 0.3);
    }

    .btn-danger {
      background: var(--error);
      color: white;
    }

    .btn-danger:hover {
      background: #cc0000;
      transform: translateY(-2px);
    }

    .btn-secondary {
      background: var(--color-bg-light);
      color: var(--color-text);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    /* FORMUL√ÅRIOS */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    label {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--color-text-muted);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    input, select, textarea {
      padding: 0.875rem;
      background: var(--color-bg-dark);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--color-text);
      font-family: inherit;
      font-size: 0.95rem;
      transition: all 0.2s;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--accent);
      background: rgba(255, 149, 0, 0.03);
    }

    /* ALERTAS */
    .alert {
      position: fixed;
      top: 2rem;
      right: 2rem;
      padding: 1.25rem 1.75rem;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      z-index: 9999;
      animation: slideIn 0.3s ease;
      display: flex;
      align-items: center;
      gap: 1rem;
      border: 1px solid;
      max-width: 400px;
    }

    @keyframes slideIn {
      from {
        transform: translateX(120%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .alert-success {
      background: rgba(0, 255, 136, 0.1);
      border-color: var(--success);
      color: var(--success);
    }

    .alert-error {
      background: rgba(255, 68, 68, 0.1);
      border-color: var(--error);
      color: var(--error);
    }

    .alert-info {
      background: var(--accent-dim);
      border-color: var(--accent);
      color: var(--accent);
    }

    /* LOADING */
    .loading {
      display: none;
      text-align: center;
      padding: 2rem;
    }

    .loading.active {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
    }

    .spinner {
      width: 32px;
      height: 32px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* P√ÅGINAS (TABS) */
    .page {
      display: none;
    }

    .page.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* GR√ÅFICOS SIMPLES (ASCII) */
    .chart-simple {
      display: flex;
      align-items: flex-end;
      gap: 0.5rem;
      height: 120px;
      padding: 1rem;
      background: rgba(255, 149, 0, 0.02);
      border-radius: 12px;
      border: 1px solid var(--border);
    }

    .chart-bar {
      flex: 1;
      background: var(--accent);
      border-radius: 4px 4px 0 0;
      position: relative;
      transition: all 0.3s;
      min-height: 20px;
    }

    .chart-bar:hover {
      background: var(--accent-light);
      transform: translateY(-4px);
    }

    .chart-bar-label {
      position: absolute;
      bottom: -1.5rem;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.7rem;
      color: var(--color-text-muted);
      white-space: nowrap;
    }

    /* SEARCH BAR */
    .search-box {
      position: relative;
      max-width: 400px;
    }

    .search-box input {
      width: 100%;
      padding-left: 2.75rem;
    }

    .search-box i {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--color-text-muted);
    }

    /* ACTIONS */
    .actions {
      display: flex;
      gap: 0.5rem;
    }

    .btn-icon {
      width: 36px;
      height: 36px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--color-text-muted);
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-icon:hover {
      border-color: var(--accent);
      color: var(--accent);
      background: var(--accent-dim);
    }

    .btn-icon.danger:hover {
      border-color: var(--error);
      color: var(--error);
      background: rgba(255, 68, 68, 0.1);
    }

    /* EMPTY STATE */
    .empty-state {
      text-align: center;
      padding: 3rem 1rem;
    }

    .empty-state i {
      font-size: 4rem;
      color: var(--border);
      margin-bottom: 1rem;
    }

    .empty-state h3 {
      color: var(--color-text);
      margin-bottom: 0.5rem;
    }

    .empty-state p {
      color: var(--color-text-muted);
    }

    /* RESPONSIVE */
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s;
      }

      .sidebar.mobile-open {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
        padding: 1rem;
      }

      .metrics-grid {
        grid-template-columns: 1fr;
      }

      .top-bar {
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }
    }

    /* MODAL */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 10000;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(4px);
    }

    .modal.active {
      display: flex;
      animation: fadeIn 0.3s ease;
    }

    .modal-content {
      background: var(--color-card);
      border-radius: 16px;
      padding: 2rem;
      max-width: 600px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      border: 1px solid var(--border);
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from {
        transform: translateY(50px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border);
    }

    .modal-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--color-text);
    }

    .btn-close {
      width: 32px;
      height: 32px;
      border: none;
      background: transparent;
      color: var(--color-text-muted);
      font-size: 1.5rem;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.2s;
    }

    .btn-close:hover {
      background: rgba(255, 68, 68, 0.1);
      color: var(--error);
    }
  </style>
</head>
<body>
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <h1><i class="fas fa-bolt"></i> Admin Panel</h1>
      <p>Energia para Todos</p>
    </div>

    <nav>
      <ul class="sidebar-menu">
        <li class="menu-item">
          <a href="#" class="menu-link active" data-page="dashboard">
            <i class="fas fa-chart-line"></i>
            <span>Dashboard</span>
          </a>
        </li>
        <li class="menu-item">
          <a href="#" class="menu-link" data-page="usuarios">
            <i class="fas fa-users"></i>
            <span>Usu√°rios</span>
          </a>
        </li>
        <li class="menu-item">
          <a href="#" class="menu-link" data-page="beneficiarios">
            <i class="fas fa-hands-helping"></i>
            <span>Benefici√°rios</span>
          </a>
        </li>
        <li class="menu-item">
          <a href="#" class="menu-link" data-page="doadores">
            <i class="fas fa-heart"></i>
            <span>Doadores</span>
          </a>
        </li>
        <li class="menu-item">
          <a href="#" class="menu-link" data-page="creditos">
            <i class="fas fa-battery-full"></i>
            <span>Cr√©ditos</span>
          </a>
        </li>
        <li class="menu-item">
          <a href="#" class="menu-link" data-page="fila">
            <i class="fas fa-list-ol"></i>
            <span>Fila de Espera</span>
          </a>
        </li>

        <div class="menu-section">Sistema</div>

        <li class="menu-item">
          <a href="#" class="menu-link" data-page="logs">
            <i class="fas fa-history"></i>
            <span>Logs de Auditoria</span>
          </a>
        </li>
        <li class="menu-item">
          <a href="/" class="menu-link">
            <i class="fas fa-home"></i>
            <span>Voltar ao Site</span>
          </a>
        </li>
      </ul>
    </nav>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="main-content">
    <!-- TOP BAR -->
    <div class="top-bar">
      <h2 id="page-title">Dashboard</h2>
      <div style="display: flex; align-items: center; gap: 1rem;">
        <div class="user-info">
          <div class="user-avatar">A</div>
          <div>
            <div style="font-weight: 600; font-size: 0.9rem;" id="user-name">Administrador</div>
            <div style="font-size: 0.75rem; color: var(--color-text-muted);" id="user-email">admin@sistema.com</div>
          </div>
        </div>
        <button class="btn-logout" onclick="fazerLogout()">
          <i class="fas fa-sign-out-alt"></i> Sair
        </button>
      </div>
    </div>

    <!-- P√ÅGINA: DASHBOARD -->
    <div id="dashboard" class="page active">
      <!-- M√âTRICAS -->
      <div class="metrics-grid">
        <div class="metric-card">
          <div class="metric-header">
            <div class="metric-icon orange">
              <i class="fas fa-users"></i>
            </div>
          </div>
          <div class="metric-value" id="metric-usuarios">0</div>
          <div class="metric-label">Total de Usu√°rios</div>
          <div class="metric-change positive">
            <i class="fas fa-arrow-up"></i>
            <span id="usuarios-change">+0%</span>
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-header">
            <div class="metric-icon green">
              <i class="fas fa-heart"></i>
            </div>
          </div>
          <div class="metric-value" id="metric-doadores">0</div>
          <div class="metric-label">Doadores Ativos</div>
        </div>

        <div class="metric-card">
          <div class="metric-header">
            <div class="metric-icon blue">
              <i class="fas fa-hands-helping"></i>
            </div>
          </div>
          <div class="metric-value" id="metric-beneficiarios">0</div>
          <div class="metric-label">Benefici√°rios</div>
        </div>

        <div class="metric-card">
          <div class="metric-header">
            <div class="metric-icon orange">
              <i class="fas fa-battery-full"></i>
            </div>
          </div>
          <div class="metric-value" id="metric-creditos-disponiveis">0</div>
          <div class="metric-label">kWh Dispon√≠veis</div>
        </div>

        <div class="metric-card">
          <div class="metric-header">
            <div class="metric-icon green">
              <i class="fas fa-check-circle"></i>
            </div>
          </div>
          <div class="metric-value" id="metric-creditos-distribuidos">0</div>
          <div class="metric-label">kWh Distribu√≠dos</div>
        </div>

        <div class="metric-card">
          <div class="metric-header">
            <div class="metric-icon blue">
              <i class="fas fa-list-ol"></i>
            </div>
          </div>
          <div class="metric-value" id="metric-fila">0</div>
          <div class="metric-label">Na Fila de Espera</div>
        </div>

        <div class="metric-card">
          <div class="metric-header">
            <div class="metric-icon orange">
              <i class="fas fa-clock"></i>
            </div>
          </div>
          <div class="metric-value" id="metric-atividades-24h">0</div>
          <div class="metric-label">Atividades (24h)</div>
        </div>

        <div class="metric-card">
          <div class="metric-header">
            <div class="metric-icon green">
              <i class="fas fa-leaf"></i>
            </div>
          </div>
          <div class="metric-value" id="metric-co2">0</div>
          <div class="metric-label">kg CO2 Evitados</div>
        </div>
      </div>

      <!-- ATIVIDADES RECENTES -->
      <div class="section">
        <div class="section-header">
          <div class="section-title">
            <i class="fas fa-history"></i>
            Atividades Recentes
          </div>
          <button class="btn btn-secondary" onclick="carregarLogs()">
            <i class="fas fa-sync"></i> Atualizar
          </button>
        </div>
        <div class="loading" id="loading-atividades">
          <div class="spinner"></div>
          <span>Carregando...</span>
        </div>
        <div class="table-container" id="container-atividades"></div>
      </div>

      <!-- DISTRIBUI√á√ÉO POR TIPO -->
      <div class="section">
        <div class="section-header">
          <div class="section-title">
            <i class="fas fa-chart-pie"></i>
            Distribui√ß√£o de Usu√°rios
          </div>
        </div>
        <div class="chart-simple" id="chart-usuarios"></div>
      </div>
    </div>

    <!-- P√ÅGINA: USU√ÅRIOS -->
    <div id="usuarios" class="page">
      <div class="section">
        <div class="section-header">
          <div class="section-title">
            <i class="fas fa-users"></i>
            Gerenciar Usu√°rios
          </div>
          <button class="btn btn-primary" onclick="carregarUsuarios()">
            <i class="fas fa-sync"></i> Atualizar Lista
          </button>
        </div>

        <div class="search-box" style="margin-bottom: 1.5rem;">
          <i class="fas fa-search"></i>
          <input type="search" id="search-usuarios" placeholder="Buscar usu√°rios por nome, email ou ID...">
        </div>

        <div class="loading" id="loading-usuarios">
          <div class="spinner"></div>
          <span>Carregando usu√°rios...</span>
        </div>

        <div class="table-container" id="container-usuarios"></div>
      </div>

      <!-- FORMUL√ÅRIO DE EDI√á√ÉO -->
      <div class="section">
        <div class="section-header">
        <div class="section-title">
        <i class="fas fa-edit"></i>
          Atualizar Dados do Usu√°rio
      </div>
    </div>

        <form id="form-atualizar">
      <div class="form-grid">
        <div class="form-group">
          <label><i class="fas fa-hashtag"></i> ID do Usu√°rio</label>
          <input type="number" name="id_usuario" required min="1">
        </div>
        <div class="form-group">
          <label><i class="fas fa-user"></i> Nome Completo</label>
          <input type="text" name="nome" required>
        </div>
        <div class="form-group">
          <label><i class="fas fa-envelope"></i> Email</label>
          <input type="email" name="email" required>
        </div>
      </div>
      <button type="submit" class="btn btn-primary">
        <i class="fas fa-save"></i> Atualizar Dados
      </button>
    </form>
  </div>

  <!-- ALTERAR SENHA -->
  <div class="section">
    <div class="section-header">
      <div class="section-title">
        <i class="fas fa-key"></i>
        Alterar Senha
      </div>
    </div>
    
    <form id="form-alterar-senha">
      <div class="form-grid">
        <div class="form-group">
          <label><i class="fas fa-at"></i> Email de Login</label>
          <input type="email" name="login" required>
        </div>
        <div class="form-group">
          <label><i class="fas fa-lock"></i> Senha Atual</label>
          <input type="password" name="senha_atual" required>
        </div>
        <div class="form-group">
          <label><i class="fas fa-lock-open"></i> Nova Senha</label>
          <input type="password" name="senha_nova" required>
        </div>
      </div>
      <button type="submit" class="btn btn-primary">
        <i class="fas fa-shield-alt"></i> Alterar Senha
      </button>
    </form>
  </div>

  <!-- EXCLUIR USU√ÅRIO -->
  <div class="section">
    <div class="section-header">
      <div class="section-title">
        <i class="fas fa-trash-alt"></i>
        Excluir Usu√°rio
      </div>
    </div>
    
    <form id="form-excluir">
      <div class="form-grid">
        <div class="form-group">
          <label><i class="fas fa-user-times"></i> Email do Usu√°rio</label>
          <input type="email" name="email" required>
        </div>
      </div>
      <button type="submit" class="btn btn-danger">
        <i class="fas fa-exclamation-triangle"></i> Excluir Usu√°rio
      </button>
      <p style="color: var(--color-text-muted); margin-top: 1rem; text-align: center;">
        <i class="fas fa-info-circle"></i> Aten√ß√£o: Esta a√ß√£o √© irrevers√≠vel!
      </p>
    </form>
  </div>
</div>

<!-- P√ÅGINA: BENEFICI√ÅRIOS -->
<div id="beneficiarios" class="page">
  <div class="section">
    <div class="section-header">
      <div class="section-title">
        <i class="fas fa-hands-helping"></i>
        Benefici√°rios Cadastrados
      </div>
      <button class="btn btn-primary" onclick="carregarBeneficiarios()">
        <i class="fas fa-sync"></i> Atualizar
      </button>
    </div>

    <div class="loading" id="loading-beneficiarios">
      <div class="spinner"></div>
      <span>Carregando...</span>
    </div>

    <div class="table-container" id="container-beneficiarios"></div>
  </div>
</div>

<!-- P√ÅGINA: DOADORES -->
<div id="doadores" class="page">
  <div class="section">
    <div class="section-header">
      <div class="section-title">
        <i class="fas fa-heart"></i>
        Doadores Cadastrados
      </div>
      <button class="btn btn-primary" onclick="carregarDoadores()">
        <i class="fas fa-sync"></i> Atualizar
      </button>
    </div>

    <div class="loading" id="loading-doadores">
      <div class="spinner"></div>
      <span>Carregando...</span>
    </div>

    <div class="table-container" id="container-doadores"></div>
  </div>
</div>

<!-- P√ÅGINA: CR√âDITOS -->
<div id="creditos" class="page">
  <div class="section">
    <div class="section-header">
      <div class="section-title">
        <i class="fas fa-battery-full"></i>
        Gest√£o de Cr√©ditos
      </div>
      <button class="btn btn-primary" onclick="carregarCreditos()">
        <i class="fas fa-sync"></i> Atualizar
      </button>
    </div>

    <div class="loading" id="loading-creditos">
      <div class="spinner"></div>
      <span>Carregando...</span>
    </div>

    <div class="table-container" id="container-creditos"></div>
  </div>

  <!-- A√á√ÉO: DISTRIBUIR CR√âDITOS -->
  <div class="section">
    <div class="section-header">
      <div class="section-title">
        <i class="fas fa-share-alt"></i>
        Distribuir Cr√©ditos Manualmente
      </div>
    </div>
    
    <form id="form-distribuir">
      <div class="form-grid">
        <div class="form-group">
          <label><i class="fas fa-hashtag"></i> Limite de Benefici√°rios</label>
          <input type="number" name="limite" value="10" min="1" max="100" required>
          <small style="color: var(--color-text-muted); font-size: 0.8rem;">
            N√∫mero m√°ximo de benefici√°rios a atender
          </small>
        </div>
      </div>
      <button type="submit" class="btn btn-primary">
        <i class="fas fa-paper-plane"></i> Executar Distribui√ß√£o
      </button>
    </form>
  </div>
</div>

<!-- P√ÅGINA: FILA -->
<div id="fila" class="page">
  <div class="section">
    <div class="section-header">
      <div class="section-title">
        <i class="fas fa-list-ol"></i>
        Fila de Espera
      </div>
      <button class="btn btn-primary" onclick="carregarFila()">
        <i class="fas fa-sync"></i> Atualizar
      </button>
    </div>

    <div class="loading" id="loading-fila">
      <div class="spinner"></div>
      <span>Carregando...</span>
    </div>

    <div class="table-container" id="container-fila"></div>
  </div>
</div>

<!-- P√ÅGINA: LOGS -->
<div id="logs" class="page">
  <div class="section">
    <div class="section-header">
      <div class="section-title">
        <i class="fas fa-history"></i>
        Logs de Auditoria
      </div>
      <button class="btn btn-primary" onclick="carregarLogs()">
        <i class="fas fa-sync"></i> Atualizar
      </button>
    </div>

    <div class="loading" id="loading-logs">
      <div class="spinner"></div>
      <span>Carregando...</span>
    </div>

    <div class="table-container" id="container-logs"></div>
  </div>
  <!-- ESTAT√çSTICAS DO SISTEMA -->
<div class="section">
  <div class="section-header">
    <div class="section-title">
      <i class="fas fa-server"></i>
      Estat√≠sticas do Sistema
    </div>
  </div>
  
  <div class="metrics-grid">
    <div class="metric-card">
      <div class="metric-icon blue">
        <i class="fas fa-database"></i>
      </div>
      <div class="metric-value" id="stat-total-registros">0</div>
      <div class="metric-label">Total de Registros</div>
    </div>
    
    <div class="metric-card">
      <div class="metric-icon green">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="metric-value" id="stat-transacoes">0</div>
      <div class="metric-label">Transa√ß√µes Realizadas</div>
    </div>
    
    <div class="metric-card">
      <div class="metric-icon orange">
        <i class="fas fa-chart-line"></i>
      </div>
      <div class="metric-value" id="stat-logs">0</div>
      <div class="metric-label">Logs de Auditoria</div>
    </div>
  </div>
</div>
</div>

</main>
  <!-- MODAL GEN√âRICO -->
  <div id="modal-generic" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="modal-title">T√≠tulo</h3>
        <button class="btn-close" onclick="fecharModal()">&times;</button>
      </div>
      <div id="modal-body"></div>
    </div>
  </div>
  <script>
    // ============================================
    // VERIFICA√á√ÉO DE PERMISS√ÉO
    // ============================================
    async function verificarPermissao() {
      try {
        const response = await fetch('/api/meu-perfil');
        const data = await response.json();

        if (!data.sucesso || data.tipo !== 'ADMINISTRADOR') {
          mostrarAlerta('‚ùå Acesso negado! Apenas administradores podem acessar esta p√°gina.', 'error');
          setTimeout(() => {
            window.location.href = '/login';
          }, 2000);
          return false;
        }

        // Atualiza informa√ß√µes do usu√°rio na interface
        document.getElementById('user-name').textContent = data.nome || 'Administrador';
        document.getElementById('user-email').textContent = data.email || '';
        
        const avatar = document.querySelector('.user-avatar');
        if (avatar && data.nome) {
          avatar.textContent = data.nome.charAt(0).toUpperCase();
        }

        return true;
      } catch (error) {
        console.error('Erro ao verificar permiss√£o:', error);
        mostrarAlerta('‚ùå Erro ao verificar permiss√µes. Redirecionando...', 'error');
        setTimeout(() => {
          window.location.href = '/login';
        }, 2000);
        return false;
      }
    }

    // Verifica permiss√£o ao carregar p√°gina
    document.addEventListener('DOMContentLoaded', async () => {
      const temPermissao = await verificarPermissao();
      if (temPermissao) {
        carregarDashboard();
      }
    });

    // ============================================
    // NAVEGA√á√ÉO ENTRE P√ÅGINAS
    // ============================================
    document.querySelectorAll('.menu-link').forEach(link => {
      link.addEventListener('click', (e) => {
        const pageId = link.dataset.page;
        if (!pageId) return;
        
        e.preventDefault();

        // Atualiza menu ativo
        document.querySelectorAll('.menu-link').forEach(l => l.classList.remove('active'));
        link.classList.add('active');

        // Mostra p√°gina correta
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        const page = document.getElementById(pageId);
        if (page) {
          page.classList.add('active');
          
          // Atualiza t√≠tulo
          const titles = {
            'dashboard': 'Dashboard',
            'usuarios': 'Gerenciar Usu√°rios',
            'beneficiarios': 'Benefici√°rios',
            'doadores': 'Doadores',
            'creditos': 'Gest√£o de Cr√©ditos',
            'fila': 'Fila de Espera',
            'logs': 'Logs de Auditoria',
            'configuracoes': 'Configura√ß√µes'
          };
          document.getElementById('page-title').textContent = titles[pageId] || 'Admin Panel';

          // Carrega dados da p√°gina
          carregarDadosPagina(pageId);
        }
      });
    });

    function carregarDadosPagina(pageId) {
      switch(pageId) {
        case 'dashboard':
          carregarDashboard();
          break;
        case 'usuarios':
          carregarUsuarios();
          break;
        case 'beneficiarios':
          carregarBeneficiarios();
          break;
        case 'doadores':
          carregarDoadores();
          break;
        case 'creditos':
          carregarCreditos();
          break;
        case 'fila':
          carregarFila();
          break;
        case 'logs':
          carregarLogs();
          carregarEstatisticasSistema();
          break;
      }
    }

    // ============================================
    // CARREGAR DASHBOARD
    // ============================================
    async function carregarDashboard() {
      try {
        const response = await fetch('/api/admin/metricas');
        const data = await response.json();

        if (data.sucesso) {
          const m = data.metricas;
          
          document.getElementById('metric-usuarios').textContent = m.total_usuarios || 0;
          document.getElementById('metric-doadores').textContent = m.total_doadores || 0;
          document.getElementById('metric-beneficiarios').textContent = m.total_beneficiarios || 0;
          document.getElementById('metric-creditos-disponiveis').textContent = (m.creditos_disponiveis || 0).toFixed(2);
          document.getElementById('metric-creditos-distribuidos').textContent = (m.creditos_distribuidos || 0).toFixed(2);
          document.getElementById('metric-fila').textContent = m.beneficiarios_na_fila || 0;
          document.getElementById('metric-atividades-24h').textContent = m.atividades_24h || 0;
          
          // C√°lculo CO2
          const co2 = ((m.creditos_distribuidos || 0) * 0.356).toFixed(2);
          document.getElementById('metric-co2').textContent = co2;

          // Gr√°fico simples
          renderizarGraficoUsuarios(m.total_doadores, m.total_beneficiarios, m.total_usuarios - m.total_doadores - m.total_beneficiarios);
        }

        // Carrega atividades recentes
        carregarLogs(5);
      } catch (error) {
        console.error('Erro ao carregar dashboard:', error);
      }
    }

    function renderizarGraficoUsuarios(doadores, beneficiarios, outros) {
      const chart = document.getElementById('chart-usuarios');
      if (!chart) return;

      // Visual mais limpo: apenas dois contadores num√©ricos
      chart.innerHTML = `
        <div style="display:flex; gap:1.5rem; justify-content:center; align-items:center; padding:1rem;">
          <div style="background: linear-gradient(135deg,var(--accent),var(--accent-light)); padding:1rem 1.5rem; border-radius:12px; text-align:center; min-width:160px;">
            <div style="font-size:1.6rem; font-weight:800; color:#fff;">${doadores}</div>
            <div style="font-size:0.9rem; color:var(--color-text-muted); font-weight:700; margin-top:6px;">Total de Doadores</div>
          </div>
          <div style="background: linear-gradient(135deg,var(--info), #2563eb); padding:1rem 1.5rem; border-radius:12px; text-align:center; min-width:160px;">
            <div style="font-size:1.6rem; font-weight:800; color:#fff;">${beneficiarios}</div>
            <div style="font-size:0.9rem; color:var(--color-text-muted); font-weight:700; margin-top:6px;">Total de Benefici√°rios</div>
          </div>
        </div>
      `;
    }

    // ============================================
    // CARREGAR USU√ÅRIOS
    // ============================================
    async function carregarUsuarios() {
      const container = document.getElementById('container-usuarios');
      const loading = document.getElementById('loading-usuarios');
      
      try {
        loading.classList.add('active');
        container.innerHTML = '';

        const response = await fetch('/api/usuarios');
        const data = await response.json();

        if (data.usuarios && data.usuarios.length > 0) {
          let html = `
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Nome</th>
                  <th>Email</th>
                  <th>Tipo</th>
                  <th>Status</th>
                  <th>√öltimo Login</th>
                  <th>A√ß√µes</th>
                </tr>
              </thead>
              <tbody>
          `;

          data.usuarios.forEach(u => {
            const tipo = u.id_doador ? 'DOADOR' : (u.id_beneficiario ? 'BENEFICIARIO' : 'INDEFINIDO');
            const badgeClass = tipo === 'DOADOR' ? 'badge-success' : (tipo === 'BENEFICIARIO' ? 'badge-info' : 'badge-warning');
            const ultimoLogin = u.data_ultimo_login ? new Date(u.data_ultimo_login).toLocaleString('pt-BR') : 'Nunca';

            html += `
              <tr>
                <td>${u.id_usuario}</td>
                <td>${u.nome || '-'}</td>
                <td>${u.email || '-'}</td>
                <td><span class="badge ${badgeClass}">${tipo}</span></td>
                <td><span class="badge badge-success">ATIVO</span></td>
                <td>${ultimoLogin}</td>
                <td>
                  <div class="actions">
                    <button class="btn-icon" onclick="editarUsuario(${u.id_usuario}, '${u.nome}', '${u.email}')" title="Editar">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-icon danger" onclick="confirmarExclusao('${u.email}')" title="Excluir">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
            `;
          });

          html += '</tbody></table>';
          container.innerHTML = html;

          // Implementa busca
          const searchInput = document.getElementById('search-usuarios');
          searchInput.addEventListener('input', () => {
            const q = searchInput.value.toLowerCase();
            const rows = container.querySelectorAll('tbody tr');
            rows.forEach(row => {
              const text = row.textContent.toLowerCase();
              row.style.display = text.includes(q) ? '' : 'none';
            });
          });

          mostrarAlerta(`‚úì ${data.usuarios.length} usu√°rios carregados!`, 'success');
        } else {
          container.innerHTML = `
            <div class="empty-state">
              <i class="fas fa-users-slash"></i>
              <h3>Nenhum usu√°rio encontrado</h3>
              <p>Cadastre novos usu√°rios para v√™-los aqui</p>
            </div>
          `;
        }
      } catch (error) {
        console.error('Erro:', error);
        container.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-exclamation-triangle"></i>
            <h3>Erro ao carregar</h3>
            <p>${error.message}</p>
          </div>
        `;
        mostrarAlerta('‚ùå Erro ao carregar usu√°rios', 'error');
      } finally {
        loading.classList.remove('active');
      }
    }

    function editarUsuario(id, nome, email) {
      // Preenche formul√°rio e scrolla at√© ele
      const form = document.getElementById('form-atualizar');
      form.querySelector('[name="id_usuario"]').value = id;
      form.querySelector('[name="nome"]').value = nome;
      form.querySelector('[name="email"]').value = email;
      
      form.scrollIntoView({ behavior: 'smooth', block: 'center' });
      form.querySelector('[name="nome"]').focus();
    }

    function confirmarExclusao(email) {
      if (confirm(`‚ö†Ô∏è ATEN√á√ÉO\n\nDeseja realmente excluir o usu√°rio:\n\n${email}\n\n‚ùå Esta a√ß√£o N√ÉO pode ser desfeita!`)) {
        excluirUsuario(email);
      }
    }

    async function excluirUsuario(email) {
      try {
        const formData = new URLSearchParams();
        formData.append('email', email);

        const response = await fetch('/usuario/excluir', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: formData
        });

        const data = await response.json();
        
        if (data.sucesso) {
          mostrarAlerta('‚úì Usu√°rio exclu√≠do com sucesso!', 'success');
          carregarUsuarios(); // Recarrega lista
        } else {
          mostrarAlerta('‚ùå ' + (data.mensagem || 'Erro ao excluir'), 'error');
        }
      } catch (error) {
        console.error('Erro:', error);
        mostrarAlerta('‚ùå Erro ao processar requisi√ß√£o', 'error');
      }
    }

    // ============================================
// FORMUL√ÅRIOS - ATUALIZAR, SENHA, EXCLUIR
// ============================================
document.getElementById('form-atualizar').addEventListener('submit', async (e) => {
  e.preventDefault();
  const form = e.target;
  const btn = form.querySelector('button[type="submit"]');
  const originalText = btn.innerHTML;
  
  try {
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Atualizando...';
    
    const formData = new FormData(form);
    const response = await fetch('/usuario/atualizar-dados', {
      method: 'POST',
      body: new URLSearchParams(formData)
    });

    const data = await response.json();
    
    if (data.sucesso) {
      mostrarAlerta('‚úì Dados atualizados com sucesso!', 'success');
      form.reset();
      await carregarUsuarios();
    } else {
      mostrarAlerta('‚úñ ' + (data.mensagem || 'Erro ao atualizar'), 'error');
    }
  } catch (error) {
    console.error('Erro:', error);
    mostrarAlerta('‚úñ Erro ao processar requisi√ß√£o', 'error');
  } finally {
    btn.disabled = false;
    btn.innerHTML = originalText;
  }
});

document.getElementById('form-alterar-senha').addEventListener('submit', async (e) => {
  e.preventDefault();
  const form = e.target;
  const btn = form.querySelector('button[type="submit"]');
  const originalText = btn.innerHTML;
  
  try {
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Alterando...';
    
    const formData = new FormData(form);
    const response = await fetch('/usuario/alterar-senha', {
      method: 'POST',
      body: new URLSearchParams(formData)
    });

    const data = await response.json();
    
    if (data.sucesso) {
      mostrarAlerta('‚úì Senha alterada com sucesso!', 'success');
      form.reset();
    } else {
      mostrarAlerta('‚úñ ' + (data.mensagem || 'Erro ao alterar senha'), 'error');
    }
  } catch (error) {
    console.error('Erro:', error);
    mostrarAlerta('‚úñ Erro ao processar requisi√ß√£o', 'error');
  } finally {
    btn.disabled = false;
    btn.innerHTML = originalText;
  }
});

document.getElementById('form-excluir').addEventListener('submit', async (e) => {
  e.preventDefault();
  const email = e.target.querySelector('[name="email"]').value;
  
  if (!confirm(`‚ö†Ô∏è ATEN√á√ÉO CR√çTICA\n\nVoc√™ est√° prestes a excluir PERMANENTEMENTE o usu√°rio:\n\nüìß ${email}\n\n‚úñ Esta a√ß√£o N√ÉO PODE ser desfeita!\n\nDeseja realmente continuar?`)) {
    return;
  }

  const btn = e.target.querySelector('button[type="submit"]');
  const originalText = btn.innerHTML;
  
  try {
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Excluindo...';
    
    await excluirUsuario(email);
    e.target.reset();
    await carregarUsuarios();
  } catch (error) {
    console.error('Erro:', error);
  } finally {
    btn.disabled = false;
    btn.innerHTML = originalText;
  }
});
    // ============================================
    // CARREGAR BENEFICI√ÅRIOS
    // ============================================
    async function carregarBeneficiarios() {
      const container = document.getElementById('container-beneficiarios');
      const loading = document.getElementById('loading-beneficiarios');
  
      try {
        loading.classList.add('active');
        container.innerHTML = '';

        const response = await fetch('/api/admin/beneficiarios');
        const data = await response.json();

        if (data.beneficiarios && data.beneficiarios.length > 0) {
          let html = `
            <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>Email</th>
                <th>Renda Familiar</th>
                <th>Moradores</th>
                <th>Consumo M√©dio</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
        `;

        data.beneficiarios.forEach(b => {
          html += `
            <tr>
              <td>${b.id_beneficiario}</td>
              <td>${b.nome || '-'}</td>
              <td>${b.email || '-'}</td>
              <td>R$ ${parseFloat(b.valor_renda || 0).toFixed(2)}</td>
              <td>${b.num_moradores || 0}</td>
              <td>${parseFloat(b.media_kwh || 0).toFixed(2)} kWh</td>
              <td><span class="badge badge-success">${b.descricao_status_beneficiario || 'ATIVO'}</span></td>
            </tr>
          `;
        });

        html += '</tbody></table>';
        container.innerHTML = html;
        mostrarAlerta(`‚úî ${data.beneficiarios.length} benefici√°rios carregados!`, 'success');
      } else {
        container.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-hands-helping"></i>
            <h3>Nenhum benefici√°rio cadastrado</h3>
          </div>
        `;
      }
    } catch (error) {
      console.error('Erro:', error);
      mostrarAlerta('‚ùå Erro ao carregar benefici√°rios', 'error');
    } finally {
      loading.classList.remove('active');
    }
  }

    // ============================================
    // CARREGAR DOADORES
    // ============================================
    async function carregarDoadores() {
  const container = document.getElementById('container-doadores');
  const loading = document.getElementById('loading-doadores');
  
  try {
    loading.classList.add('active');
    container.innerHTML = '';

    const response = await fetch('/api/admin/doadores');
    const data = await response.json();

    if (data.doadores && data.doadores.length > 0) {
      let html = `
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Nome</th>
              <th>Email</th>
              <th>Classifica√ß√£o</th>
              <th>Total Doado (kWh)</th>
              <th>Data Cadastro</th>
            </tr>
          </thead>
          <tbody>
      `;

      data.doadores.forEach(d => {
        html += `
          <tr>
            <td>${d.id_doador}</td>
            <td>${d.nome || '-'}</td>
            <td>${d.email || '-'}</td>
            <td><span class="badge badge-info">${d.descricao_classificacao || 'PF'}</span></td>
            <td>${parseFloat(d.total_doado || 0).toFixed(2)}</td>
            <td>${d.data_cadastro ? new Date(d.data_cadastro).toLocaleDateString('pt-BR') : '-'}</td>
          </tr>
        `;
      });

      html += '</tbody></table>';
      container.innerHTML = html;
      mostrarAlerta(`‚úî ${data.doadores.length} doadores carregados!`, 'success');
    } else {
      container.innerHTML = `
        <div class="empty-state">
          <i class="fas fa-heart"></i>
          <h3>Nenhum doador cadastrado</h3>
        </div>
      `;
    }
  } catch (error) {
    console.error('Erro:', error);
    mostrarAlerta('‚ùå Erro ao carregar doadores', 'error');
  } finally {
    loading.classList.remove('active');
  }
}

async function carregarCreditos() {
  const container = document.getElementById('container-creditos');
  const loading = document.getElementById('loading-creditos');
  
  try {
    loading.classList.add('active');
    container.innerHTML = '';

    const response = await fetch('/api/admin/creditos');
    const data = await response.json();

    if (data.creditos && data.creditos.length > 0) {
      let html = `
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Doador</th>
              <th>Dispon√≠vel (kWh)</th>
              <th>Status</th>
              <th>Expira√ß√£o</th>
            </tr>
          </thead>
          <tbody>
      `;

      data.creditos.forEach(c => {
        let badgeClass = 'badge-info';
        if (c.status === 'DISPONIVEL') badgeClass = 'badge-success';
        else if (c.status === 'PARCIALMENTE_UTILIZADO') badgeClass = 'badge-warning';
        else if (c.status === 'ESGOTADO' || c.status === 'EXPIRADO') badgeClass = 'badge-error';
        
        html += `
          <tr>
            <td>${c.id_credito}</td>
            <td>${c.nome_doador || '-'}</td>
            <td>${parseFloat(c.quantidade_disponivel_kwh || 0).toFixed(2)}</td>
            <td><span class="badge ${badgeClass}">${c.status}</span></td>
            <td>${c.data_expiracao ? new Date(c.data_expiracao).toLocaleDateString('pt-BR') : 'Sem expira√ß√£o'}</td>
          </tr>
        `;
      });

      html += '</tbody></table>';
      container.innerHTML = html;
      mostrarAlerta(`‚úì ${data.creditos.length} cr√©ditos carregados!`, 'success');
    } else {
      container.innerHTML = `
        <div class="empty-state">
          <i class="fas fa-battery-empty"></i>
          <h3>Nenhum cr√©dito dispon√≠vel</h3>
        </div>
      `;
    }
  } catch (error) {
    console.error('Erro:', error);
    mostrarAlerta('‚úñ Erro ao carregar cr√©ditos', 'error');
  } finally {
    loading.classList.remove('active');
  }
}

// DISTRIBUIR CR√âDITOS
document.getElementById('form-distribuir').addEventListener('submit', async (e) => {
  e.preventDefault();
  const form = e.target;
  const btn = form.querySelector('button[type="submit"]');
  const originalText = btn.innerHTML;
  
  if (!confirm('‚ö° Executar distribui√ß√£o autom√°tica de cr√©ditos?')) {
    return;
  }

  try {
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Distribuindo...';
    
    const limite = form.querySelector('[name="limite"]').value;
    const response = await fetch('/api/admin/distribuir', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ limite: parseInt(limite) })
    });

    const data = await response.json();
    
    if (data.sucesso) {
      mostrarAlerta(`‚úì Distribui√ß√£o conclu√≠da! ${data.resultado.beneficiarios_atendidos} benefici√°rios atendidos`, 'success');
      await carregarCreditos();
      await carregarFila();
      await carregarDashboard();
    } else {
      mostrarAlerta('‚úñ ' + (data.mensagem || 'Erro ao distribuir'), 'error');
    }
  } catch (error) {
    console.error('Erro:', error);
    mostrarAlerta('‚úñ Erro ao processar requisi√ß√£o', 'error');
  } finally {
    btn.disabled = false;
    btn.innerHTML = originalText;
  }
});

// ============================================
// CARREGAR FILA
// ============================================
async function carregarFila() {
  const container = document.getElementById('container-fila');
  const loading = document.getElementById('loading-fila');
  
  try {
    loading.classList.add('active');
    container.innerHTML = '';

    const response = await fetch('/api/admin/fila');
    const data = await response.json();

    if (data.fila && data.fila.length > 0) {
      let html = `
        <table>
          <thead>
            <tr>
              <th>Posi√ß√£o</th>
              <th>Nome</th>
              <th>Email</th>
              <th>Renda</th>
              <th>kWh Solicitado</th>
              <th>Prioridade</th>
              <th>Data Entrada</th>
            </tr>
          </thead>
          <tbody>
      `;

      data.fila.forEach((f, index) => {
        html += `
          <tr>
            <td><strong>${index + 1}¬∫</strong></td>
            <td>${f.nome || '-'}</td>
            <td>${f.email || '-'}</td>
            <td>R$ ${parseFloat(f.renda_familiar || 0).toFixed(2)}</td>
            <td>${parseFloat(f.consumo_medio_kwh || 0).toFixed(2)}</td>
            <td>${f.prioridade || 0}</td>
            <td>${f.data_entrada ? new Date(f.data_entrada).toLocaleString('pt-BR') : '-'}</td>
          </tr>
        `;
      });

      html += '</tbody></table>';
      container.innerHTML = html;
      mostrarAlerta(`‚úì ${data.fila.length} benefici√°rios na fila!`, 'success');
    } else {
      container.innerHTML = `
        <div class="empty-state">
          <i class="fas fa-list-ol"></i>
          <h3>Fila vazia</h3>
          <p>Nenhum benefici√°rio aguardando atendimento</p>
        </div>
      `;
    }
  } catch (error) {
    console.error('Erro:', error);
    mostrarAlerta('‚ùå Erro ao carregar fila', 'error');
  } finally {
    loading.classList.remove('active');
  }
}

// ============================================
// CARREGAR LOGS
// ============================================
async function carregarLogs(limite = 50) {
  const container = document.getElementById('container-logs') || document.getElementById('container-atividades');
  const loading = document.getElementById('loading-logs') || document.getElementById('loading-atividades');
  
  if (!container) return;

  try {
    loading.classList.add('active');
    container.innerHTML = '';

    const response = await fetch(`/api/admin/logs?limite=${limite}`);
    const data = await response.json();

    if (data.logs && data.logs.length > 0) {
      let html = `
        <table>
          <thead>
            <tr>
              <th>Data/Hora</th>
              <th>Usu√°rio</th>
              <th>A√ß√£o</th>
              <th>Detalhes</th>
              <th>IP</th>
            </tr>
          </thead>
          <tbody>
      `;

      data.logs.forEach(l => {
        html += `
          <tr>
            <td>${l.data_hora ? new Date(l.data_hora).toLocaleString('pt-BR') : '-'}</td>
            <td>${l.nome_usuario || 'Sistema'}</td>
            <td><span class="badge badge-info">${l.descricao_tipo_acao || '-'}</span></td>
            <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${l.detalhes || '-'}</td>
            <td>${l.ip_acesso || '-'}</td>
          </tr>
        `;
      });

      html += '</tbody></table>';
      container.innerHTML = html;
    } else {
      container.innerHTML = `
        <div class="empty-state">
          <i class="fas fa-history"></i>
          <h3>Nenhum log encontrado</h3>
        </div>
      `;
    }
  } catch (error) {
    console.error('Erro:', error);
  } finally {
    loading.classList.remove('active');
  }
}

// ============================================
// ESTAT√çSTICAS DO SISTEMA
// ============================================
async function carregarEstatisticasSistema() {
  try {
    const response = await fetch('/api/admin/estatisticas');
    const data = await response.json();

    if (data.sucesso) {
      document.getElementById('stat-total-registros').textContent = data.total_registros || 0;
      document.getElementById('stat-transacoes').textContent = data.total_transacoes || 0;
      document.getElementById('stat-logs').textContent = data.total_logs || 0;
    }
  } catch (error) {
    console.error('Erro ao carregar estat√≠sticas:', error);
  }
}

// ============================================
// ALERTAS
// ============================================
function mostrarAlerta(mensagem, tipo = 'info') {
  const iconMap = {
    success: 'fa-check-circle',
    error: 'fa-exclamation-circle',
    info: 'fa-info-circle'
  };

  const alert = document.createElement('div');
  alert.className = `alert alert-${tipo}`;
  alert.innerHTML = `
    <i class="fas ${iconMap[tipo]}"></i>
    <span>${mensagem}</span>
  `;
  document.body.appendChild(alert);
  
  setTimeout(() => {
    alert.style.animation = 'slideIn 0.3s ease reverse';
    setTimeout(() => alert.remove(), 300);
  }, 5000);
}

// ============================================
// LOGOUT
// ============================================
async function fazerLogout() {
  if (confirm('üö™ Deseja realmente sair do painel administrativo?')) {
    try {
      await fetch('/api/logout', { method: 'POST' });
      mostrarAlerta('üëã Logout realizado com sucesso!', 'success');
      setTimeout(() => {
        window.location.href = '/login';
      }, 1000);
    } catch (error) {
      console.error('Erro no logout:', error);
      window.location.href = '/login';
    }
  }
}

// ============================================
// MODAL
// ============================================
function abrirModal(titulo, conteudo) {
  document.getElementById('modal-title').textContent = titulo;
  document.getElementById('modal-body').innerHTML = conteudo;
  document.getElementById('modal-generic').classList.add('active');
}

function fecharModal() {
  document.getElementById('modal-generic').classList.remove('active');
}

// Fecha modal ao clicar fora
document.getElementById('modal-generic').addEventListener('click', (e) => {
  if (e.target.id === 'modal-generic') {
    fecharModal();
  }
});
  </script>
</body>
</html>